@page
@using Bibliotek.Models
@model Bibliotek.Pages.SearchModel
@{
    ViewData["Title"] = "Search page";
    int counter = 1;

  
}


<div>
    <h1 class="display-4">List of products</h1>
</div>

<div class="col-4">
    <form method="get">
        <div class="input-group">
            <input class="form-control" asp-for="SearchKey" />
            <div class="input-group-append">
                <button type="submit" class="btn btn-primary" style="margin-left: 10px;">Search</button>
            </div>
        </div>
    </form>
</div>
<br />



<table id="tableId" class="table">
  <thead class="table-dark">
    <tr>
      <th scope="col">#</th>
      <th scope="col">Title</th>
      <th scope="col">Author</th>
      <th scope="col">Type</th>
        <th scope="col">Genre</th>
      <th scope="col">Pages</th>
      <th scope="col">Specyfication</th>
      <th scope="col">Availability</th>

    </tr>
  </thead>
 
    <tbody>
        @foreach (var obj in @Model.Products)
        {
            <tr>
                <th scope="row">@(counter++)</th>
                <td>@obj.Release.Title </td>
                <td>@obj.Release.Author</td>
                <td>@obj.Type</td>
                <td>@obj.Release.Genre</td>
                <td>@obj.Release.Pages</td>
                @{
                    if (obj.Type == "Book")
                    {
                        //var book = (BookModel)obj;
                        //<td>Format: @book.BookFormat</td>
                      <td>Format: A4</td>
                    }
                    if (obj.Type == "Ebook")
                    {
                        //var ebook = (EBookModel)obj;
                        //<td>Size: @ebook.DataSize</td>
                         <td>Size: 1,3 Mb</td>
                    }
                       if (obj.Type == "Movie")
                    {
                        //var movie = (MovieModel)obj;
                        //<td>Length: @movie.Length</td>
                          <td>Length: 94</td>
                    }
                }

                @{
                    if (Model.LoggedUser != null)
                    {
                        if (Model.LoggedUser.Role == Role.User)
                        {
                            if (obj.Lent)
                            {
                                <td>
                                    <i class="bi bi-dash-circle-fill" style="color:red"> Item not available</i>
                                </td>
                            }
                            else
                            {
                                <td>

                                    <button type="submit" class="btn btn-warning
        ">
                                        <a asp-page="/RentProduct" asp-page-handler="Product" asp-route-id="@obj.Id"> Rent this product </a>
                                    </button>
                                </td>
                            }
                        }
                        else 
                        {
                            <td> @(!obj.Lent ? "Available" : "Non available")</td>
                        }
                    }
                    else
                    {
                        <td> @(!obj.Lent ? "Available" : "Non available")</td>
                    }
                }

            </tr>
        }
    </tbody>
</table>


